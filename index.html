<!DOCTYPE html>
<html>
  <head>
    <title>Tidy data structures and visualisation   to support exploration and modeling of temporal-context data</title>
    <meta charset="utf-8">
    <meta name="author" content="Earo Wang" />
    <link href="index_files/remark-css/default.css" rel="stylesheet" />
    <link href="index_files/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="myremark.css" type="text/css" />
    <link rel="stylesheet" href="timeline.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Tidy data structures and visualisation <br> to support exploration and modeling of temporal-context data
### Earo Wang
### Mar 14, 2018 <br> slides at <a href="http://slides.earo.me/phd18" class="uri">http://slides.earo.me/phd18</a>

---







class: middle

## Agenda

* **WIP**: Tidy data structures to support exploration and modeling of temporal-context data
* **Done**: Calendar-based graphics for visualising people’s daily schedules
* **ToDo**: Visualisation of time series with nested and crossed factors

---

background-image: url(figure/map-airlines-1.svg)
background-size: cover

class: bottom center



# USA airline traffic in 2016 &amp; 2017

*data source: [Bureau of Transportation Statistics](https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236)*

---

background-image: url(img/data-snapshot.png)
background-size: cover

class: inverse bottom center

# Data snapshot

---

.pull-left[
* heterogeneous data types
* multiple measured variables
]
.pull-right[
* fine scale time resolution
* multiple grouping variables
]
.center[&lt;img src="img/data-snapshot.png" height=460px&gt;]

---

## However ...

The current structure that underlies the time series objects:

`\begin{equation}
  \begin{bmatrix}
  X_{11} &amp; X_{21} &amp; \cdots &amp; X_{p1} \\
  X_{12} &amp; X_{22} &amp; \cdots &amp; X_{p2} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  X_{1T} &amp; X_{2T} &amp; \cdots &amp; X_{pT}
  \end{bmatrix}
\end{equation}`

where `\(X_{jt}\)` represents series `\(j\)`, for `\(j = 1, \dots, p\)` and `\(1 \leq t \leq T\)`, in the form of a `\(T \times p\)` matrix.

--

It requires

* homogeneity (numerical variables)
* time indices implicitly inferred as attributes/meta-information

--

This matrix format is **model-centric**.

---

class: middle

## The matrix structure

.x[
* discards interesting information in the data;
* is more opaque in handling of the temporal components;
* is less efficient for many other data analysis tasks, like forcing the fitting of a square peg into a round hole (削足适履).
]

---

class: middle

## Programmatic workflow

.pull-left[

```r
for (...) {
  if (...) {
    ...
  } else {
    ...
  }
  for (...) {
  }
}
...
for (...) {
  if (...) {
    ...
  } else {
    ...
  }
  for (...) {
  }
}
```
]

--

.pull-right[
.shake[&lt;img src="img/duang.png" size=50%&gt;]
&gt; Where I'm doing wrong?

&gt; What I'm doing?
]

---

class: middle

## Instead, we'd like

.checked[
* heterogeneous data types to keep the richness of data
* explicitly declared index variable to be easily accessible
* a syntactical approach to express nested or crossed factors
* data pipelines to facilitate the workflow
]

---

class: inverse middle center

.scale-up[&lt;img src="img/tsibble.svg" height=200px size=50%&gt;]

## Chinglish for time series tibble

---

class: inverse middle center

&lt;img src="img/tsibble.svg" height=200px size=50%&gt;

## ~~Chinglish for time series tibble~~
## The future of time series in R

---

.left-column[
## Tidy temporal data
### - definition
]
.right-column[
.large[Tidy data principles:]
* Each variable forms a column.
* Each observation forms a row.
* Each type of observational unit forms a table.

Make a table
]

---

.left-column[
## Tidy temporal data
### - definition
]
.right-column[
.large[Tidy temporal data:]
* **index**: an explicitly declared variable containing time indices.
* **key**: uniquely identifies each unit that measurements take place on over time.
* **interval**: a common time interval if data with regular time interval.

Make a table
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
]
.right-column[
An explicitly declared variable (e.g. `sched_dep_datetime`) which could contain:
* date/date-time: 

```
#&gt; [1] "2018-03-14 16:00:00 UTC" "2018-03-14 16:15:00 UTC"
```
* year-month:

```
#&gt; [1] "2018 Jan" "2018 Feb"
```
* year-quarter:

```
#&gt; [1] "2018 Q1" "2018 Q2"
```
* year:

```
#&gt; [1] 2017 2018
```
* and etc.
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
]
.right-column[
Uniquely identifies each unit that measurements take place on over time:
* single: 

```r
id(flight)
```
* nested:

```r
id(origin | origin_city | origin_state)
```
* crossed:

```r
id(origin, dest)
```
* nested &amp; crossed

```r
id(origin | origin_state, dest | dest_state)
```
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
### - tsibble
]
.right-column[

```r
library(tsibble)
flights %&gt;% 
  as_tsibble(key = id(flight), 
    index = sched_dep_datetime, regular = FALSE)
```

```
*#&gt; # A tsibble: 11,076,746 x 27 [!]
*#&gt; # Keys:      flight [24,647]
#&gt;    flight sched_dep_datetime  dep_time sched_dep_time
#&gt;    &lt;chr&gt;  &lt;dttm&gt;                 &lt;int&gt;          &lt;int&gt;
#&gt;  1 AA1    2016-01-01 09:00:00      856            900
#&gt;  2 AA1    2016-01-02 09:00:00      857            900
#&gt;  3 AA1    2016-01-03 09:00:00      913            900
#&gt;  4 AA1    2016-01-04 09:00:00      903            900
#&gt;  5 AA1    2016-01-05 09:00:00      850            900
#&gt;  6 AA1    2016-01-06 09:00:00      855            900
#&gt; # ... with 11,076,740 more rows, and 23 more variables:
#&gt; #   dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;,
#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, tailnum &lt;chr&gt;,
#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
#&gt; #   distance &lt;dbl&gt;, origin_city_name &lt;chr&gt;,
#&gt; #   origin_state &lt;chr&gt;, origin_state_name &lt;chr&gt;,
#&gt; #   dest_city_name &lt;chr&gt;, dest_state &lt;chr&gt;,
#&gt; #   dest_state_name &lt;chr&gt;, taxi_out &lt;dbl&gt;, taxi_in &lt;dbl&gt;,
#&gt; #   carrier_delay &lt;dbl&gt;, weather_delay &lt;dbl&gt;,
#&gt; #   nas_delay &lt;dbl&gt;, security_delay &lt;dbl&gt;,
#&gt; #   late_aircraft_delay &lt;dbl&gt;
```

]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
### - tsibble
]
.right-column[
.center[.large[I. flexible]]

Make a chart
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
### - tsibble
]
.right-column[
.center[.large[II. mapping from data semantics to its physical layout]]
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
### - tsibble
]
.right-column[
.center[.large[III. WYTIWYG]]

.pull-left[
**verb+noun**

filter observations for 2017
]
.pull-right[
**function+variable**

```r
filter(index == 2017)
```
]
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
### - tsibble
]
.right-column[
.center[.large[III. WYTIWYG]]

.pull-left[
**verb+noun**

select variable except for `a`
]
.pull-right[
**function+variable**

```r
select(-a)
```
]
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
### - tsibble
]
.right-column[
.center[.large[III. WYTIWYG]]

.pull-left[
**verb+noun**

add a new variable `z`
]
.pull-right[
**function+variable**

```r
mutate(z = x * y)
```
]
]

---

.left-column[
## Tidy temporal data
### - definition
### - index
### - key
### - tsibble
]
.right-column[
.center[.large[IV. verbs]]

A consistent set of verbs to solve a wide range of data transformation problems:

* row-wise: `filter()`, `slice()`, `arrange()`, `fill_na()`
* column-wise: `mutate()`, `select()`, `summarise()`, `tsummarise()`

These all naturally work with `group_by()`.

* rolling window: `slide()`, `tile()`, `stretch()`
]

---

.left-column[
## Data pipelines
]
.right-column[
.flowchart[`filter()` ojfeojfo j fejfoeojfw ojfowjf]
.flowchart[`filter()` ojfeojfo j fejfoeojfw ojfowjf]
]

---

.left-column[
## Timeline
### - Done
]
.right-column[
.timeline.timeline-left.timeline-with-arrows[
.timeline-block[
.arrow-right[
.timeline-content[
[**Tidy data and statistical visualisation to support exploration of temporal data with R**](http://slides.earo.me/medascin17/) &lt;br&gt;
Workshop @ Data Science Week, Melbourne
.timeline-date[
2017/05
]]]]
.timeline-block[
.arrow-right[
.timeline-content[
[**Sketch people’s daily schedules**](http://slides.earo.me/wombat17/) &lt;br&gt;
Lightning @ Wombat, Melbourne
.timeline-date[
2017/05
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
sugrrants v0.1.0 CRAN release
.timeline-date[
2017/07
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
[**Calendar-based graphics for visualizing people’s daily schedules**](http://pub.earo.me/calendar-vis.pdf) submitted to JSS
.timeline-date[
2017/08
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
[**Analysing sub-daily time series data**](http://slides.earo.me/meetup17/) &lt;br&gt;
Invited talk @ MelbURN, Melbourne
.timeline-date[
2017/10
]]]]
]
]

---

.left-column[
## Timeline
### - Done
]
.right-column[
.timeline.timeline-left.timeline-with-arrows[
.timeline-block[
.arrow-right[
.timeline-content[
[**Calendar-based graphics for visualizing people’s daily schedules**](http://slides.earo.me/iasc17/) &lt;br&gt;
Contributed talk @ IASC, Auckland
.timeline-date[
2017/12
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
tsibble v0.1.0 CRAN release
.timeline-date[
2018/01
]]]]
.timeline-block[
.arrow-right[
.timeline-content[
**Calendar-based graphics for visualizing people’s daily schedules**
won the 2018 ASA Statistical Graphics Student Paper Award
.timeline-date[
2018/01
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
[**When time series meets tibble, it’s tsibble!**](http://slides.earo.me/rstudioconf18/tsibble.pdf)
Poster @ rstudio::conf, San Diego
.timeline-date[
2018/01
]]]]
]
]

---

.left-column[
## Timeline
### - Done
### - ToDo
]
.right-column[
.timeline.timeline-left.purple-flirt.timeline-with-arrows[
.timeline-block[
.arrow-right[
.timeline-content[
Academic visit @ Paris &amp; Brussels
.timeline-date[
2018/04
]]]]
.timeline-block[
.arrow-right[
.timeline-content[
**Tidy data structures to support exploration and modeling of temporal-context data**
submitted JCGS
.timeline-date[
2018/07
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
**Tidy data structures to support exploration and modeling of temporal-context data** &lt;br&gt;
Contributed talk @ UseR!2018, Brisbane
.timeline-date[
2018/07
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
**Calendar-based graphics for visualizing people’s daily schedules** &lt;br&gt;
Contributed talk @ JSM, Vancouver
.timeline-date[
2018/08
]]]]
]
]

---


.left-column[
## Timeline
### - Done
### - ToDo
]
.right-column[
.timeline.timeline-left.purple-flirt.timeline-with-arrows[
.timeline-block[
.arrow-right[
.timeline-content[
**Tidy data structures to support exploration and modeling of temporal-context data** &lt;br&gt;
Contributed talk @ ISCB, Melbourne
.timeline-date[
2018/08
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
**Visualisation of time series with nested and crossed factors**
.timeline-date[
2019/03
]]]]

.timeline-block[
.arrow-right[
.timeline-content[
Thesis ✌️
.timeline-date[
2019/06
]]]]
]
]

---

class: inverse middle center

## Joint work with Di &amp; Rob

&lt;img src="img/super.jpg" height=420px size=50%&gt;

---

class: inverse middle center

### made with [<i class="fa  fa-heart "></i>]() and .orange[<i class="fa  fa-coffee "></i>]
### xaringan ⚔️ slides &lt;http://slides.earo.me/phd18&gt;
### reproducible &amp; open source &lt;https://github.com/earowang/phd18&gt;
### This work is under licensed [CC BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/).
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
